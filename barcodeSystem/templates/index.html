<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Label Generator - Thermal Printer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div id="undertakerBackground" class="undertaker-background"></div>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-text">
                    <h1 id="mainTitle">
                        <span class="fire-char">B</span><span class="fire-char">l</span><span class="fire-char">a</span><span class="fire-char">c</span><span class="fire-char">k</span> <span class="fire-char">R</span><span class="fire-char">a</span><span class="fire-char">b</span><span class="fire-char">b</span><span class="fire-char">i</span><span class="fire-char">t</span><span class="fire-char">'</span><span class="fire-char">s</span><br><span class="fire-char">B</span><span class="fire-char">a</span><span class="fire-char">d</span><span class="fire-char">a</span><span class="fire-char">s</span><span class="fire-char">s</span> <span class="fire-char">L</span><span class="fire-char">a</span><span class="fire-char">b</span><span class="fire-char">e</span><span class="fire-char">l</span> <span class="fire-char">G</span><span class="fire-char">e</span><span class="fire-char">n</span><span class="fire-char">e</span><span class="fire-char">r</span><span class="fire-char">a</span><span class="fire-char">t</span><span class="fire-char">o</span><span class="fire-char">r</span>
                    </h1>
                    <p id="headerSubtitle">Generate 3"√ó1" labels for thermal printers (203 DPI)</p>
                </div>
                <button id="settingsBtn" class="settings-btn" title="Settings">
                    <img src="{{ url_for('static', filename='gear_2699.png') }}" alt="Settings" class="gear-icon">
                </button>
            </div>
        </header>

        <div class="upload-section">
            <!-- Label Size Toggle -->
            <div class="label-size-toggle">
                <h3>Select Label Size</h3>
                <div class="toggle-control">
                    <button type="button" class="toggle-btn" data-size="2x1">
                        üìè 2" √ó 1"
                    </button>
                    <button type="button" class="toggle-btn active" data-size="3x1">
                        üìè 3" √ó 1"
                    </button>
                </div>
            </div>

            <form id="uploadForm" enctype="multipart/form-data">
                <input type="hidden" id="labelSizeInput" name="label_size" value="3x1">
                <div class="file-input-container">
                    <div id="dropZone" class="drop-zone">
                        <div class="drop-zone-content">
                            <div class="upload-icon">üìÅ</div>
                            <h3>Drop your file here or click to browse</h3>
                            <p>Supports .xlsx and .csv files (max 10MB)</p>
                            <input type="file" id="fileInput" name="file" accept=".xlsx,.csv" style="display: none;">
                        </div>
                    </div>
                </div>

                <div id="fileInfo" class="file-info" style="display: none;">
                    <div class="file-details">
                        <span id="fileName"></span>
                        <span id="fileSize"></span>
                    </div>
                    <button type="button" id="removeFile" class="remove-btn">√ó</button>
                </div>

                <button type="submit" id="generateBtn" class="generate-btn" disabled>
                    Generate Labels
                </button>
            </form>

            <div id="progressContainer" class="progress-container" style="display: none;">
                <div class="progress-bar">
                    <div id="progressBar" class="progress-fill"></div>
                </div>
                <p id="progressText">Processing...</p>
            </div>

            <div id="result" class="result" style="display: none;">
                <div class="success-message">
                    <h3>‚úÖ Labels Generated Successfully!</h3>
                    <p id="labelCount"></p>
                    <a id="downloadLink" class="download-btn" href="#" download>
                        üì• Download PDF
                    </a>
                </div>
            </div>

            <div id="error" class="error" style="display: none;">
                <div class="error-message">
                    <h3>‚ùå Error</h3>
                    <p id="errorText"></p>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h2>üìã File Format Requirements</h2>
            <div class="format-info">
                <p>This application supports two file formats:</p>

                <h3>üìã Original Format</h3>
                <p>Your Excel (.xlsx) or CSV file must contain these columns:</p>
                <ul>
                    <li><strong>Product</strong> - Product name/title</li>
                    <li><strong>Size</strong> - Size code (S, M, L, XL, etc.)</li>
                    <li><strong>Quantity</strong> - Number of labels to generate</li>
                    <li><strong>Datamatrix URL</strong> - URL to the DataMatrix image</li>
                </ul>

                <h3>üÜï Enhanced Format</h3>
                <p>For order management systems with additional details:</p>
                <ul>
                    <li><strong>Order - Number</strong> - Order reference number</li>
                    <li><strong>Item - SKU</strong> - Product SKU code</li>
                    <li><strong>Item - Name</strong> - HTML product description (auto-parsed)</li>
                    <li><strong>Item - Qty</strong> - Quantity to generate</li>
                    <li><strong>Item - Image URL</strong> - URL to DataMatrix image</li>
                    <li><strong>Market - Store Name</strong> - Store/marketplace name</li>
                    <li><strong>Date - Ship By Date</strong> - Shipping deadline</li>
                </ul>

                <p class="note">
                    <strong>Note:</strong> The application automatically detects your file format.
                    Each label will be printed as a separate page, optimized for thermal printers at 203 DPI.
                    Labels are automatically sorted by size (S‚ÜíM‚ÜíL‚ÜíXL‚Üí2XL‚Üí3XL‚Üí4XL‚Üí5XL‚Üí6XL) for efficient garment picking.
                    Enhanced format includes order details at the bottom of each label.
                </p>
            </div>

            <div class="sample-data">
                <h3>Example Data - Original Format:</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Size</th>
                            <th>Quantity</th>
                            <th>Datamatrix URL</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Vintage T-Shirt Design</td>
                            <td>M</td>
                            <td>2</td>
                            <td>https://example.com/datamatrix.png</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Example Data - Enhanced Format:</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Order - Number</th>
                            <th>Item - SKU</th>
                            <th>Item - Name</th>
                            <th>Item - Qty</th>
                            <th>Market - Store Name</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>BR-47678</td>
                            <td>BRSHIRT-THREATLEVEL-BK-L</td>
                            <td>SOFT PREMIUM TEE - Black - L - The Office Threat Level...</td>
                            <td>1</td>
                            <td>Black Rabbit Shopify</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Settings</h2>
                <span class="close">&times;</span>
            </div>

            <div class="modal-body">
                <div class="tabs">
                    <button class="tab-button active" data-tab="product-types">Product Types</button>
                    <button class="tab-button" data-tab="shortening-rules">Shortening Rules</button>
                    <button class="tab-button" data-tab="application-settings">Application Settings</button>
                    <button class="tab-button" data-tab="import-export">Import/Export</button>
                </div>

                <!-- Product Types Tab -->
                <div id="product-types-tab" class="tab-content active">
                    <div class="tab-header">
                        <h3>Product Types</h3>
                        <p>Manage the list of product types that can be recognized from CSV data.</p>
                    </div>

                    <div class="product-types-section">
                        <div class="add-product-type">
                            <input type="text" id="newProductType" placeholder="Enter new product type (e.g., 'Soft Premium Tee - Black')">
                            <button id="addProductTypeBtn" class="btn-primary">Add</button>
                        </div>

                        <div class="product-types-list">
                            <ul id="productTypesList" class="settings-list">
                                <!-- Product types will be dynamically loaded here -->
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Shortening Rules Tab -->
                <div id="shortening-rules-tab" class="tab-content">
                    <div class="tab-header">
                        <h3>Shortening Rules</h3>
                        <p>Configure how product types are shortened for better label display.</p>
                    </div>

                    <div class="shortening-rules-section">
                        <div class="add-rule">
                            <button id="addRuleBtn" class="btn-primary">Add New Rule</button>
                        </div>

                        <div class="rules-list">
                            <div id="shorteningRulesList" class="rules-container">
                                <!-- Shortening rules will be dynamically loaded here -->
                            </div>
                        </div>

                        <div class="test-section">
                            <h4>Test Rules</h4>
                            <input type="text" id="testInput" placeholder="Enter product type to test">
                            <button id="testRulesBtn" class="btn-secondary">Test</button>
                            <div id="testResult" class="test-result"></div>
                        </div>
                    </div>
                </div>

                <!-- Application Settings Tab -->
                <div id="application-settings-tab" class="tab-content">
                    <div class="tab-header">
                        <h3>Application Settings</h3>
                        <p>Configure default application behavior and label settings.</p>
                    </div>

                    <div class="application-settings-section">
                        <div class="setting-group">
                            <h4>Binning System</h4>
                            <div class="setting-field">
                                <label for="maxBinsInput">Maximum Number of Bins</label>
                                <input type="number" id="maxBinsInput" min="1" value="12" placeholder="Enter maximum bins (e.g., 12)">
                                <p class="field-description">Multi-item orders are assigned bins 1 through this number. Orders exceeding this limit go to the overflow area.</p>
                            </div>
                            <div class="setting-field">
                                <label for="overflowNameInput">Overflow Area Name</label>
                                <input type="text" id="overflowNameInput" value="THEPIT" placeholder="Enter overflow area name (e.g., THEPIT)">
                                <p class="field-description">Name displayed on labels for orders exceeding the maximum bin count.</p>
                            </div>
                        </div>

                        <div class="setting-group">
                            <h4>Label Defaults</h4>
                            <div class="setting-field">
                                <label for="defaultLabelSizeSelect">Default Label Size</label>
                                <select id="defaultLabelSizeSelect">
                                    <option value="2x1">2" √ó 1"</option>
                                    <option value="3x1" selected>3" √ó 1"</option>
                                </select>
                                <p class="field-description">The label size that is pre-selected when the page loads.</p>
                            </div>
                        </div>

                        <div class="setting-group">
                            <h4>Celebration Effects</h4>
                            <div class="setting-field">
                                <label>
                                    <input type="checkbox" id="deadmanModeCheckbox">
                                    Deadman Mode
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Import/Export Tab -->
                <div id="import-export-tab" class="tab-content">
                    <div class="tab-header">
                        <h3>Import/Export</h3>
                        <p>Backup, share, or restore your settings configuration.</p>
                    </div>

                    <div class="import-export-section">
                        <div class="export-section">
                            <h4>Export Settings</h4>
                            <p>Download your current configuration as a JSON file.</p>
                            <button id="exportBtn" class="btn-primary">Export Settings</button>
                        </div>

                        <div class="import-section">
                            <h4>Import Settings</h4>
                            <p>Upload a JSON configuration file to replace current settings.</p>
                            <input type="file" id="importFile" accept=".json" style="display: none;">
                            <button id="importBtn" class="btn-secondary">Import Settings</button>
                        </div>

                        <div class="reset-section">
                            <h4>Reset to Defaults</h4>
                            <p>‚ö†Ô∏è This will restore default settings and cannot be undone.</p>
                            <button id="resetBtn" class="btn-danger">Reset to Defaults</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button id="saveSettingsBtn" class="btn-primary">Save Changes</button>
                <button id="cancelSettingsBtn" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>